plugins {
    id 'application'
    id 'com.github.johnrengelman.shadow'
}

mainClassName = "com.r3.conclave.jvmperf.JvmPerf"

def mode = sgx_mode.toLowerCase()

dependencies {
    compile project(":jvm-perf:benchmarks")
    implementation "com.r3.conclave:conclave-host"
    implementation "com.r3.conclave:conclave-client"
    compile "org.openjdk.jmh:jmh-core:1.19"
    annotationProcessor "org.openjdk.jmh:jmh-generator-annprocess:1.19"

    runtimeOnly project(path: ":jvm-perf:avian-enclave-simulation", configuration: "simulation")
    runtimeOnly project(path: ":jvm-perf:graalvm-enclave-simulation", configuration: "simulation")
    runtimeOnly project(path: ":jvm-perf:avian-enclave-debug", configuration: "debug")
    runtimeOnly project(path: ":jvm-perf:graalvm-enclave-debug", configuration: "debug")
    runtimeOnly "org.slf4j:slf4j-simple:1.7.30"
}

test {
    // Pass through any -Pspid and -Pattestation-key parameters to the tests
    systemProperties project.properties.subMap(["spid", "attestation-key"])
}

shadowJar {
    archiveFileName = "jvm-perf-all.jar"
}